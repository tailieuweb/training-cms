(function(e){"use strict";e(document).ready(function(e){function t(e,t){e.css({"-moz-transform":t,"-webkit-transform":t,"-ms-transform":t,"-o-transform":t,transform:t}),e.prev().css({visibility:"hidden"})}var i=function(e){this.element=e,this.handleContainer=this.element.find(".cd-product-viewer-handle"),this.handleFill=this.handleContainer.children(".fill"),this.handle=this.handleContainer.children(".handle"),this.imageWrapper=this.element.find(".product-viewer"),this.slideShow=this.imageWrapper.children(".product-sprite"),this.frames=this.element.data("frame"),this.friction=this.element.data("friction"),this.visibleFrame=0,this.loaded=!1,this.animating=!1,this.xPosition=0,this.loadFrames()};i.prototype.loadFrames=function(){var t=this,i=this.slideShow.data("image"),a=e("<img/>");this.loading("0.5"),a.attr("src",i).load(i,function(){e(this).remove(),t.loaded=!0}).each(function(){this.complete&&e(this).trigger("load")})},i.prototype.loading=function(e){var i=this;t(this.handleFill,"scaleX("+e+")"),setTimeout(function(){if(i.loaded)i.element.addClass("loaded"),t(i.handleFill,"scaleX(1)"),i.dragImage(),i.handle&&i.dragHandle();else{var a=parseFloat(e)+.1;a<1?i.loading(a):i.loading(parseFloat(e))}},500)},i.prototype.dragHandle=function(){var t=this;t.handle.on("mousedown touchstart",function(i){t.handle.addClass("cd-draggable");var a=t.handle.outerWidth(),n=t.handleContainer.offset().left,o=t.handleContainer.outerWidth(),s=n-a/2,r=n+o-a/2;t.xPosition=t.handle.offset().left+a-(e(window).width()<992&&i.originalEvent.touches?i.originalEvent.touches[0].pageX:i.pageX),t.element.on("mousemove touchmove",function(e){t.animating||(t.animating=!0,window.requestAnimationFrame?requestAnimationFrame(function(){t.animateDraggedHandle(e,a,n,o,s,r)}):setTimeout(function(){t.animateDraggedHandle(e,a,n,o,s,r)},100))}).one("mouseup touchend",function(e){t.handle.removeClass("cd-draggable"),t.element.off("mousemove touchmove")}),i.preventDefault()}).on("mouseup touchend",function(e){t.handle.removeClass("cd-draggable")})},i.prototype.animateDraggedHandle=function(t,i,a,n,o,s){var r=(e(window).width()<992&&t.originalEvent.touches?t.originalEvent.touches[0].pageX:t.pageX)+this.xPosition-i;r<o?r=o:r>s&&(r=s);var d=Math.ceil(1e3*(r+i/2-a)/n)/10;this.visibleFrame=Math.ceil(d*(this.frames-1)/100),this.updateFrame(),e(".cd-draggable",this.handleContainer).css("left",d+"%").one("mouseup touchend",function(){e(this).removeClass("cd-draggable")}),this.animating=!1},i.prototype.dragImage=function(){var t=this;t.slideShow.on("mousedown touchstart",function(i){t.slideShow.addClass("cd-draggable");var a=t.imageWrapper.offset().left,n=t.imageWrapper.outerWidth();t.frames;t.xPosition=e(window).width()<992?i.originalEvent.touches[0].pageX:i.pageX,t.element.on("mousemove touchmove",function(e){t.animating||(t.animating=!0,window.requestAnimationFrame?requestAnimationFrame(function(){t.animateDraggedImage(e,a,n)}):setTimeout(function(){t.animateDraggedImage(e,a,n)},100))}).one("mouseup touchend",function(e){t.slideShow.removeClass("cd-draggable"),t.element.off("mousemove touchmove"),t.updateHandle()}),i.preventDefault()}).on("mouseup touchend",function(e){t.slideShow.removeClass("cd-draggable")})},i.prototype.animateDraggedImage=function(t,i,a){var n=this.xPosition-(e(window).width()<992?t.originalEvent.touches[0].pageX:t.pageX),o=Math.ceil(100*n/(a*this.friction))*(this.frames-1)/100;o=o>0?Math.floor(o):Math.ceil(o);var s=this.visibleFrame+o;s<0?s=this.frames-1:s>this.frames-1&&(s=0),s!=this.visibleFrame&&(this.visibleFrame=s,this.updateFrame(),this.xPosition=e(window).width()<992?t.originalEvent.touches[0].pageX:t.pageX),this.animating=!1},i.prototype.updateHandle=function(){if(this.handle){var e=100*this.visibleFrame/this.frames;this.handle.animate({left:e+"%"},200)}},i.prototype.updateFrame=function(){var e=-100*this.visibleFrame/this.frames;t(this.slideShow,"translateX("+e+"%)")};e(".cd-product-viewer-wrapper").each(function(){new i(e(this))}),window.parent.vc&&window.parent.vc.events&&window.parent.vc.events.on("shortcodeView:ready",function(t){if(t.view.$el){"porto_360degree_image_viewer"==t.attributes.shortcode&&t.view.$el.find(".cd-product-viewer-wrapper").each(function(){e(this).hasClass("fe-init")||(new i(e(this)),e(this).addClass("fe-init"))})}})})}).apply(this,[jQuery]);