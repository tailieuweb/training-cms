!function(a){"use strict";a(document).ready(function(){b.init()});var b={importData:{},allowPopupClosing:!0,init:function(){var b=this;this.categoriesFilter(),a(".envo-search-input").on("keyup",function(){0<a(this).val().length?(a(".envo-demo-wrap .themes").find(".theme-wrap").hide(),a(".envo-demo-wrap .themes").find('.theme-wrap[data-name*="'+a(this).val().toLowerCase()+'"]').show()):a(".envo-demo-wrap .themes").find(".theme-wrap").show()}),a(".envo-demo-wrap .theme-actions a.button").on("click",function(a){a.stopPropagation()}),a(".envo-open-popup").click(function(c){c.preventDefault();var d=a(this).data("demo-id"),e=a(".preview-"+d),f=a(".preview-all-"+d);e.show(),f.show(),b.getDemoData(d)}),a(document).on("click",".install-now",this.installNow),a(document).on("click",".activate-now",this.activatePlugins),a(document).on("wp-plugin-install-success",this.installSuccess),a(document).on("wp-plugin-installing",this.pluginInstalling),a(document).on("wp-plugin-install-error",this.installError)},categoriesFilter:function(){var b=a(".envo-demo-wrap .themes").find(".theme-wrap"),c="envo-is-fadeout",d="envo-is-fadein",e=200,f=function(){var d=a.Deferred();return b.addClass(c),setTimeout(function(){b.removeClass(c).hide(),d.resolve()},e),d.promise()},g=function(a,c){var f=a?'[data-categories*="'+a+'"]':"div";"all"===a&&(f="div"),b.filter(f).show().addClass("envo-is-fadein"),setTimeout(function(){b.removeClass(d),c.resolve()},e)},h=function(b){var c=a.Deferred(),d=f();return d.done(function(){g(b,c)}),c};a(".envo-navigation-link").on("click",function(b){b.preventDefault(),a(this).parent().siblings().removeClass("active"),a(this).parent().addClass("active");var c=this.hash.slice(1),d=a(".envo-demo-wrap .themes");d.css("min-width",d.outerHeight());var e=h(c);e.done(function(){d.removeAttr("style")})})},getDemoData:function(b){var c=this;a.ajax({url:envoDemos.ajaxurl,type:"get",data:{action:"envo_ajax_get_import_data",demo_name:b,security:envoDemos.envo_import_data_nonce},complete:function(b){c.importData=a.parseJSON(b.responseText)}}),a.ajax({url:envoDemos.ajaxurl,type:"get",data:{action:"envo_ajax_get_demo_data",demo_name:b,demo_data_nonce:envoDemos.demo_data_nonce},complete:function(d){c.runPopup(d);var e=a(".preview-"+b),f=a(".preview-all-"+b);e.hide(),f.hide()}})},runPopup:function(b){var c=this,d=a("html").innerWidth();a("html").css("overflow","hidden");var e=a("html").innerWidth();a("html").css("margin-right",e-d),a("#envo-demo-popup-wrap").fadeIn(),a(b.responseText).appendTo(a("#envo-demo-popup-content")),a(".envo-demo-popup-close, .envo-demo-popup-overlay").on("click",function(a){a.preventDefault(),c.allowPopupClosing===!0&&c.closePopup()}),a(".envo-plugins-next").on("click",function(b){b.preventDefault(),a("#envo-demo-plugins").hide(),a("#envo-demo-import-form").show()}),a("#envo-demo-import-form").submit(function(b){b.preventDefault();var d=a(this).find('[name="envo_import_demo"]').val(),e=a(this).find('[name="envo_import_demo_data_nonce"]').val(),f=[];a(this).find('input[type="checkbox"]').each(function(){a(this).is(":checked")===!0&&f.push(a(this).attr("name"))}),a(this).hide(),a(".envo-loader").show(),c.importContent({demo:d,nonce:e,contentToImport:f,isXML:a("#envo_import_xml").is(":checked")})})},importContent:function(b){var c,d,e=this,f=(Date.now(),{envo_import_demo:b.demo,envo_import_demo_data_nonce:b.nonce});if(this.allowPopupClosing=!1,a(".envo-demo-popup-close").fadeOut(),0===b.contentToImport.length)return setTimeout(function(){a(".envo-loader").hide(),a(".envo-last").show()},1e3),a.ajax({url:envoDemos.ajaxurl,type:"post",data:{action:"envo_after_import",envo_import_demo:b.demo,envo_import_demo_data_nonce:b.nonce,envo_import_is_xml:b.isXML},complete:function(a){}}),this.allowPopupClosing=!0,void a(".envo-demo-popup-close").fadeIn();for(var g in this.importData){var h=a.inArray(this.importData[g].input_name,b.contentToImport);if(-1!==h){c=g,b.contentToImport.splice(h,1),f.action=this.importData[g].action;break}}a(".envo-import-status").append('<p class="envo-importing">'+this.importData[c].loader+"</p>");var i=a.ajax({url:envoDemos.ajaxurl,type:"post",data:f,complete:function(c){clearTimeout(d);var f=!0;if(500===c.status||502===c.status||503===c.status)a(".envo-importing").addClass("envo-importing-failed").removeClass("envo-importing").text(envoDemos.content_importing_error+" "+c.status);else if(-1!==c.responseText.indexOf("successful import"))a(".envo-importing").addClass("envo-imported").removeClass("envo-importing");else{var g=a.parseJSON(c.responseText),h="";for(var i in g)h+=g[i],"xml_import_error"===i&&(f=!1);a(".envo-importing").addClass("envo-importing-failed").removeClass("envo-importing").text(h),e.allowPopupClosing=!0,a(".envo-demo-popup-close").fadeIn()}f===!0&&e.importContent(b)}});d=setTimeout(function(){i.abort(),e.allowPopupClosing=!0,a(".envo-demo-popup-close").fadeIn(),a(".envo-importing").addClass("envo-importing-failed").removeClass("envo-importing").text(envoDemos.content_importing_error)},9e5)},closePopup:function(){a("html").css({overflow:"","margin-right":""}),a(".preview-icon").hide(),a(".preview-all").hide(),a("#envo-demo-popup-wrap").fadeOut(),setTimeout(function(){a("#envo-demo-popup-content").html("")},600)},installNow:function(b){b.preventDefault();var c=a(b.target),d=a(document);c.hasClass("updating-message")||c.hasClass("button-disabled")||(wp.updates.shouldRequestFilesystemCredentials&&!wp.updates.ajaxLocked&&(wp.updates.requestFilesystemCredentials(b),d.on("credential-modal-cancel",function(){var b=a(".install-now.updating-message");b.removeClass("updating-message").text(wp.updates.l10n.installNow),wp.a11y.speak(wp.updates.l10n.updateCancel,"polite")})),wp.updates.installPlugin({slug:c.data("slug")}))},activatePlugins:function(b){b.preventDefault();var c=a(b.target),d=c.data("init");c.data("slug");c.hasClass("updating-message")||c.hasClass("button-disabled")||(c.addClass("updating-message button-primary").html(envoDemos.button_activating),a.ajax({url:envoDemos.ajaxurl,type:"POST",data:{action:"envo_ajax_required_plugins_activate",init:d}}).done(function(a){a.success&&c.removeClass("button-primary install-now activate-now updating-message").attr("disabled","disabled").addClass("disabled").text(envoDemos.button_active)}))},installSuccess:function(b,c){b.preventDefault();var d=a(".envo-plugin-"+c.slug).find(".button"),e=d.data("init");d.removeClass("install-now installed button-disabled updated-message").addClass("updating-message").html(envoDemos.button_activating),setTimeout(function(){a.ajax({url:envoDemos.ajaxurl,type:"POST",data:{action:"envo_ajax_required_plugins_activate",init:e}}).done(function(a){a.success?d.removeClass("button-primary install-now activate-now updating-message").attr("disabled","disabled").addClass("disabled").text(envoDemos.button_active):d.removeClass("updating-message")})},1200)},pluginInstalling:function(b,c){b.preventDefault();var d=a(".envo-plugin-"+c.slug),e=d.find(".button");e.addClass("updating-message")},installError:function(b,c){b.preventDefault();var d=a(".envo-plugin-"+c.slug);d.removeClass("button-primary").addClass("disabled").html(wp.updates.l10n.installFailedShort)}}}(jQuery);